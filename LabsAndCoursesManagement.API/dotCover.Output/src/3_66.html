<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Facultate\Labs-CoursesManagement\LabsAndCoursesManagement.API\LabsAndCoursesManagement.API.IntegrationTests\StudentsControllerTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using FluentAssertions;
using LabsAndCoursesManagement.API.IntegrationTests.Setup;
using LabsAndCoursesManagement.DataAccess.Database;
using LabsAndCoursesManagement.Models.Dtos;
using LabsAndCoursesManagement.Models.Models;
using Microsoft.Extensions.DependencyInjection;
using System.Net.Http.Json;

namespace LabsAndCoursesManagement.API.IntegrationTests
{
    public class StudentsControllerTests : BaseIntegrationTests
    {
        private const string ApiURL = &quot;/api/Students&quot;;
        private readonly Guid teacherId;
        private readonly List&lt;Guid&gt; studentIds;

        public StudentsControllerTests(CustomWebApplicationFactory&lt;Program&gt; factory) : base(factory)
        {
            using (var scope = factory.Services.CreateScope())
            {
                var scopedServices = scope.ServiceProvider;
                var db = scopedServices.GetRequiredService&lt;DatabaseContext&gt;();
                teacherId = Utilities.SeedTeachers(db);
                studentIds = Utilities.SeedStudents(db);
            }
        }

        [Fact]
        public async void When_CreatedStudent_Then_ShouldReturnStudentInTheGetRequest()
        {
            // Arrange
            CreateStudentDto studentDto = CreateSUT();
            // Act
            var createTeacherResponse = await HttpClient.PostAsJsonAsync(ApiURL, studentDto);
            var getStudentResult = await HttpClient.GetAsync(ApiURL);
            // Assert
            createTeacherResponse.EnsureSuccessStatusCode();
            createTeacherResponse.StatusCode.Should().Be(System.Net.HttpStatusCode.Created);

            getStudentResult.EnsureSuccessStatusCode();
            var students = await getStudentResult.Content
                .ReadFromJsonAsync&lt;List&lt;Teacher&gt;&gt;();
        }

        [Fact]
        public async void When_DeletedStudent_Then_ShouldReturnOk()
        {
            // Arrange
            // Act
            string ApiDeleteURL = $&quot;{ApiURL}/{studentIds[0]}&quot;;
            var deleteTeacherResult = await HttpClient.DeleteAsync(ApiDeleteURL);
            // Assert
            deleteTeacherResult.EnsureSuccessStatusCode();
            deleteTeacherResult.StatusCode.Should().Be(System.Net.HttpStatusCode.OK);
        }

        [Fact]
        public async void When_UpdatedStudent_Then_ShouldReturnNoContent()
        {
            // Arrange
            CreateStudentDto studentDto = CreateSUT();
            // Act
            string ApiUpdateURL = $&quot;{ApiURL}/{studentIds[1]}&quot;;
            studentDto.Email = &quot;new email&quot;;
            var updateStudentResult = await HttpClient.PutAsJsonAsync(ApiUpdateURL, studentDto);
            // Assert
            updateStudentResult.EnsureSuccessStatusCode();
            updateStudentResult.StatusCode.Should().Be(System.Net.HttpStatusCode.NoContent);
        }


        private CreateStudentDto CreateSUT()
        {
            return new CreateStudentDto
            {
                FullName = &quot;George Smoc&quot;,
                Email = &quot;george.smoc13@gmail.com&quot;,
                Year = 2,
                Group = &quot;B4&quot;,
                IdentificationNumber = &quot;some data that needs validation&quot;,
            };
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[17,88,17,101,1],[18,9,18,10,1],[19,20,19,62,1],[20,13,20,14,1],[21,17,21,60,1],[22,17,22,79,1],[23,17,23,56,1],[24,17,24,57,1],[25,13,25,14,1],[26,9,26,10,1],[30,9,30,10,1],[32,13,32,55,1],[34,13,34,94,1],[35,13,35,70,1],[37,13,37,61,1],[38,13,38,93,1],[40,13,40,56,1],[41,13,42,53,1],[43,9,43,10,1],[47,9,47,10,1],[50,13,50,63,1],[51,13,51,82,1],[53,13,53,59,1],[54,13,54,86,1],[55,9,55,10,1],[59,9,59,10,1],[61,13,61,55,1],[63,13,63,63,1],[64,13,64,44,1],[65,13,65,97,1],[67,13,67,59,1],[68,13,68,93,1],[69,9,69,10,1],[73,9,73,10,1],[74,13,81,15,1],[82,9,82,10,1]]);
    </script>
  </body>
</html>